{% extends 'base.html' %}

{% block title %}{{ project.name }}{% endblock %}

{% block content %}
    <h1>{{ project.name }}</h1>
    <p><strong>Status:</strong> {{ project.get_status_display }}</p>

    <hr>

    <h3>Description</h3>
    <p>{{ project.description|linebreaks }}</p>
    
    {# --- NEW PREMIUM SECTION --- #}
     {% if is_premium_user %}
        <hr>
        <h3>Project Gallery (Premium)</h3>
        
        {% for photo in project.photos.all %}
            <div style="display: inline-block; margin: 10px;">
                <img src="{{ photo.image.url }}" alt="{{ photo.caption }}" width="200">
                <p>{{ photo.caption }}</p>
            </div>
        {% empty %}
            <p>No photos yet.</p>
        {% endfor %}

        <hr>
        <h4>Upload a new photo:</h4>
        {# NOTE: The 'enctype' is crucial for file uploads #}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ photo_form.as_p }}
            <button type="submit">Upload Photo</button>
        </form>

    {% else %}
        <hr>
        <p>
            <a href="{% url 'payments:payment-page' %}">Upgrade to Premium</a> to add a photo gallery!
        </p>
    {% endif %}

    {# --- END PREMIUM SECTION --- #}

    <hr>
    <a href="{% url 'projects:project-update' project.pk %}">Edit Project</a>
    <a href="{% url 'projects:project-delete' project.pk %}" style="color: red;">Delete Project</a>
    <br>
    <a href="{% url 'projects:project-list' %}">Back to all projects</a>
{% endblock %}